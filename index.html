<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>PeerJS P2P File Share</title>
  <style>
    body { font-family: Arial; margin: 10px; background: #f7f7f7; }
    #home { padding: 10px; border: 1px solid #ccc; background: #fff; }
    #log { border: 1px solid #ccc; padding: 5px; height: 150px; overflow-y: auto; background: #000; color: #0f0; font-family: monospace; font-size: 12px; }
    #loader { display: none; }
  </style>
</head>
<body>

<div id="home">
  <h3>P2P File Sharing</h3>
  <label><input type="checkbox" id="OpenSendWindow" checked> Send</label>
  <input type="file" id="select_file_to_send"><br><br>
  <input type="text" id="peerIdToConnect" placeholder="Enter Peer ID">
  <button onclick="connectToPeer()">Connect & Send</button>
  <div id="loader"><span class="loader"></span> <b id="progressText">Sending...</b></div>
  <br><br>
  <div><b>Your ID:</b> <span id="myid"></span></div>
</div>

<h4>Log:</h4>
<div id="log">[Log started]</div>

<script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
<script>
const log = msg => {
  const logEl = document.getElementById('log');
  logEl.innerHTML += `<br>${msg}`;
  logEl.scrollTop = logEl.scrollHeight;
};

// Create Peer
const peer = new Peer(undefined, {
  host: 'peerjs.com',
  secure: true,
  port: 443
});

let conn;

// On Peer Open
peer.on('open', id => {
  document.getElementById("myid").textContent = id;
  log(`üÜî Your Peer ID: ${id}`);
});

// Incoming connection
peer.on('connection', connection => {
  conn = connection;
  log('üîó Incoming connection...');
  conn.on('data', data => {
    if (data.fileName && data.fileData) {
      const blob = new Blob([data.fileData]);
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = data.fileName;
      link.click();
      log(`‚úÖ File received: ${data.fileName}`);
    }
  });
});

// Connect to peer and send file
function connectToPeer() {
  const peerId = document.getElementById('peerIdToConnect').value.trim();
  const fileInput = document.getElementById('select_file_to_send');
  if (!peerId) return alert("Enter a valid Peer ID.");
  if (!fileInput.files.length) return alert("Please select a file.");

  conn = peer.connect(peerId);
  conn.on('open', () => {
    const file = fileInput.files[0];
    const reader = new FileReader();
    reader.onload = function () {
      conn.send({
        fileName: file.name,
        fileData: reader.result
      });
      log(`üì§ File sent: ${file.name}`);
    };
    reader.readAsArrayBuffer(file);
  });

  conn.on('error', err => {
    log(`‚ùå Error: ${err}`);
  });
}
</script>

</body>
</html>
